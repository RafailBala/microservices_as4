# Microservices

### 1. Config Server.

* В spring-cloud-config-server добавлены файлы с общими настройками для user-service и company-service.

* Созданы два микросервиса: user-service, company-service, которые настроены на подключение к Config Server.

### 2. Взаимодействие микросервисов, feign clients.

* Создан docker-compose.yaml файл, в котором описаны необходимые для работы сервисы (postgresql). Добавлены
  настройки подключения к созданной базе данных для user-service и company-service (для каждого микросервиса указана своя
  схема данных).

* Для управления миграциями баз данных подключен FlyWay в user-service и company-service. Создан скрипт для
  создания таблицы user (имя, логин, пароль, емэйл, признак активации/деактивации, идентификатор компании). Для company-
  service создан скрипт для создания таблицы компаний (название, огрн, описание дейтельности, идентификатор директора).

* Созданы соответствующие Entity, Dto (для пользователей возвращается название компании, для компаний – ФИО
  пользователя), Repository и Service.

Создан контроллер в user-service, в котором реализуются следующие end-points:
* Получение списка всех пользователей (информация о компании подтягивается синхронно из company-service)
* Активация/деактивация пользователя
* Создание пользователя (происходит синхронная проверка из company-service, на существование компании. Если компании не существует –
  404 ошибка с соответствующим сообщением)
* Обновление информации о пользователе (имя, емэйл и компания, для компании осуществляется проверка на существование)
* Проверка существования пользователя по идентификатору (если пользователь существует, но неактивен –  404 ошибка)

Создан контроллер в company-service, в котором реализуются следующие end-points:
* Проверка существования компании по ее идентификатору
* Получение списка всех компаний (с ФИО директора)
* Создание компании (осуществляется синхронная проверка из user-service, на существование директора. Если директора не существует –  404
  ошибка с соответствующим сообщением)

### 3. Service discovery, Api Gateway.
### Подключена служба обнаружения микросервисов и настроен api шлюз.

* В Discovery server в качестве службы обнаружения микросервисов добавлена eureka.
* Микросервисы user-service и company-service и Api Gateway зарегистрированы в созданном Discovery server.
* Маршруты в Api gateway заданы таким образом, чтобы все запросы, которые идут по адресу …/user/… были перенаправлены в 
  user-service, а все запросы по адресу …/company/… в company-service.
* Запросы в feign clients реализованы таким образом, чтобы вызов сервисов осуществлялся через api gateway.


### 4 Асинхронное взаимодействия микросервисов, Kafka.

* В docker-compose файл добавлен новый сервис для Kafka.
* Обновлен spring-cloud-config-server, добавив в него новые настройки для kafka.
* Создан end-point для удаления компании (компания помечается удаленной и перестает искаться в end-point для поиска 
  компаний, физически из БД компания на данном этапе не удаляется). Если компании по id не существует – 404 ошибка. 
  При удалении компании отправляется сообщение в user-service через Kafka. При получении сообщения в user-service, 
  ищутся все пользователи, работающие в данной компании, и поле company_id для них сбрасывается в null. После этого 
  отправляется сообщение в company-service, по которому компания физически удалятся из БД.